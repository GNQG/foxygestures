<!DOCTYPE html>
<html ng-app="mgOptionsApp" ng-strict-di>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="lib/ui-bootstrap-custom-2.5.0-csp.css">
    <link rel="stylesheet" href="lib/font-awesome.min.css">
    <link rel="stylesheet" href="options.css">

    <!-- WebExtension shared components -->
    <script src="../common/MouseDeltaAccumulator.js"></script>
    <script src="../common/UDLRGestureDetector.js"></script>
    <script src="../common/Optional.js"></script>
    <script src="../common/settings.js"></script>
    <script src="../content/helpers.js"></script>
    <script src="../background/helpers.js"></script>
    <script src="../background/commands.js"></script>
  </head>

  <body ng-controller="OptionsCtrl">
    <!-- Do not show until settings are loaded -->
    <form class="form" name="controls.optionsForm" ng-if="commands.loaded && settings.loaded">

      <uib-tabset active="0">

        <uib-tab index="0" heading="General Settings">

          <!-- Gesture button -->
          <div class="form-group">
            <label class="control-label">Gesture Button</label>
            <select class="form-control"
                    ng-model="settings.gestureButton">
              <option ng-value="0">Left</option>
              <option ng-value="1">Middle</option>
              <option ng-value="2">Right</option>
            </select>
            <p class="help-block">
              The mouse button used to start a gesture.
            </p>
          </div>

          <!-- Gesture timeout -->
          <div class="form-group" ng-class="{'has-error':controls.optionsForm.gestureTimeout.$invalid}">
            <label class="control-label">Gesture Timeout</label>
            <div class="input-group">
              <input class="form-control" type="number" name="gestureTimeout"
                     step="0.1" min="0" max="30"
                     ng-model="controls.gestureTimeout"></input>
              <span class="input-group-addon">seconds</span>
            </div>
            <p class="help-block">
              Cancel a gesture if there is no movement for this many seconds. Use zero to disable.
            </p>
          </div>

          <!-- Draw trails -->
          <div class="panel panel-default">
            <div class="panel-heading">
              <div class="checkbox">
                <label>
                  <input type="checkbox"
                         ng-model="settings.drawTrails"></input>
                  Draw gesture trails
                </label>
                <a class="pull-right"
                   ng-click="controls.fewerTrailOptions = !controls.fewerTrailOptions">
                  <span ng-show="controls.fewerTrailOptions">
                    More options <i class="fa fa-caret-down"></i>
                  </span>
                  <span ng-hide="controls.fewerTrailOptions">
                    Fewer options <i class="fa fa-caret-up"></i>
                  </span>
                </a>
              </div>
            </div>
            <fieldset class="panel-body"
                      uib-collapse="controls.fewerTrailOptions"
                      ng-disabled="!settings.drawTrails">
              <!-- Trail width -->
              <div class="form-group" ng-class="{'has-error':controls.optionsForm.trailWidth.$invalid}">
                <label class="control-label">Trail Width</label>
                <div class="input-group">
                  <input class="form-control" type="number" name="trailWidth"
                         step="0.5" min="0.5" max="40"
                         ng-model="settings.trailWidth"></input>
                  <span class="input-group-addon">
                    <canvas mg-trail-preview settings="settings" width="50" height="16"></canvas>
                  </span>
                </div>
              </div>

              <!-- Trail color -->
              <div class="form-group" ng-class="{'has-error':controls.optionsForm.trailColor.$invalid}">
                <label class="control-label">Trail Color</label>
                <input class="form-control" type="text" name="trailColor"
                       ng-model="settings.trailColor" css-color></input>
                <p class="help-block">
                  Any CSS color definition is accepted. e.g.: blue, #336699, or rgba(64, 128, 192, 0.5)
                </p>
              </div>
            </fieldset>
          </div>

          <!-- Draw status -->
          <div class="panel panel-default">
            <div class="panel-heading">
              <div class="checkbox">
                <label>
                  <input type="checkbox"
                         ng-model="settings.showStatusText"></input>
                  Show status text
                </label>
                <a class="pull-right"
                   ng-click="controls.fewerStatusOptions = !controls.fewerStatusOptions">
                  <span ng-show="controls.fewerStatusOptions">
                    More options <i class="fa fa-caret-down"></i>
                  </span>
                  <span ng-hide="controls.fewerStatusOptions">
                    Fewer options <i class="fa fa-caret-up"></i>
                  </span>
                </a>
              </div>
            </div>
            <fieldset class="panel-body"
                      uib-collapse="controls.fewerStatusOptions"
                      ng-disabled="!settings.showStatusText">

              <!-- Status timeout -->
              <div class="form-group" ng-class="{'has-error':controls.optionsForm.statusTimeout.$invalid}">
                <label class="control-label">Status Timeout</label>
                <div class="input-group">
                  <input class="form-control" type="number" name="statusTimeout"
                         step="0.1" min="0.1" max="30"
                         ng-model="controls.statusTimeout"></input>
                  <span class="input-group-addon">seconds</span>
                </div>
                <p class="help-block">
                  Amount of time to display the status text after a gesture.
                </p>
              </div>

              <div class="form-group">
                <label class="control-label">Status Template</label>
                <a class="pull-right" ng-click="settings.statusTemplate = settings.getDefaultTemplates().statusTemplate">Reset</a>
                <textarea class="form-control"
                          ng-model="settings.statusTemplate"></textarea>
                <p class="help-block">
                  Edit the HTML template for the status text. The content of the element with the data-mg-status attribute will be replaced with the status text.
                </p>
              </div>

            </fieldset>
          </div>

        </uib-tab>

        <uib-tab index="1" heading="Built-in Commands">

          <div class="well">
            <i class="fa fa-2x fa-info-circle"></i>
            <span>
              Perform a gesture in each box to assign the gesture for the command.
              Press and release the gesture button to clear the gesture.
          </span>
          </div>

          <!-- Command search -->
          <div class="form-group">
            <div class="input-group">
              <span class="input-group-addon">
                <i class="fa fa-search"></i>
              </span>
              <input class="form-control" type="text"
                     ng-model="controls.searchCommands"></input>
            </div>
          </div>

          <!-- List of gesture mappings -->
          <div class="mapping-list">
            <div class="mapping-item"
                 ng-repeat="command in commands | filter:controls.searchCommands | orderBy:'label'">

              <label class="control-label command-label">
                 {{command.label}}
                 <i class="fa fa-question-circle"
                    ng-if="command.tooltip"
                    uib-tooltip="{{command.tooltip}}"></i>
              </label>

              <input class="form-control mapped-gesture"
                      ng-value="getMappingForCommand(command).gesture"
                      disabled="disabled"></input>

              <canvas class="gesture-input" mg-gesture-input width="148" height="100"
                      settings="settings"
                      gesture="getMappingForCommand(command).gesture"
                      on-gesture="assignGestureToCommand(gesture, command)"></canvas>

            </div><!-- .mapping-item -->
          </div><!-- .mapping-list -->

        </uib-tab>

        <uib-tab index="2" heading="User Scripts">

          <div class="alert alert-danger self-xss-warning" ng-if="!settings.sawXSSWarning">
            <h3>
              <i class="fa fa-warning"></i>
              Warning
            </h3>

            <p class="simple-explain">
              This is a feature intended for power users. If someone told you to copy and paste something here to
              enable a feature or "hack" something, it is a scam and will give them access to your browser.
            </p>

            <p class="detail-explain">
              User scripts have access to all of the web extension APIs that can be used by Foxy Gestures. These
              APIs may be used to access browser history, download malicious JavaScript, or otherwise take over your
              browser. Never copy and paste a user script from an untrustworthy source.
            </p>

            <p class="more-information">
              For more information see the following resources:
              <ul>
                <li>
                  <a href="https://en.wikipedia.org/wiki/Cross-site_scripting" target="_blank">
                  The wikipedia article on cross-site scripting.</a>
                </li>
                <li>
                  <a href="https://en.wikipedia.org/wiki/Self-XSS" target="_blank">
                  The wikipedia article on self-XSS attacks.</a>
                </li>
                <li>
                  <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=971597" target="_blank">
                  BugZilla entry regarding self-XSS attacks via dev-tools.</a>
                </li>
              </ul>
            </p>

            <div class="clearfix">
              <button class="btn btn-danger pull-right" type="button" ng-click="settings.sawXSSWarning = true">
                I understand the risks
              </button>
            </div>
          </div>

          <div class="well" ng-if="settings.sawXSSWarning">
            <i class="fa fa-2x fa-info-circle"></i>
            <span>
              Execute a custom script with a mouse gesture.
              Please read the
              <a href="https://github.com/marklieberman/foxygestures/wiki/User-Scripts" target="_blank">user scripts</a>
              article on the wiki before proceeding.
            </span>
          </div>

          <div class="mapping-list" ng-if="settings.sawXSSWarning">
            <div class="user-script-item"
                 ng-repeat="userScript in settings.userScripts">

              <div class="user-script-mapping">
                <label class="control-label">
                   Gesture
                </label>

                <input class="form-control mapped-gesture"
                       ng-value="getMappingForUserScript(userScript).gesture"
                       disabled="disabled"></input>

                <canvas class="gesture-input" mg-gesture-input width="148" height="100"
                        settings="settings"
                        gesture="getMappingForUserScript(userScript).gesture"
                        on-gesture="assignGestureToUserScript(gesture, userScript)"></canvas>
              </div>

              <div class="user-script-settings">
                <div class="form-group">
                  <label class="control-label">User Script</label>
                  <div class="input-group">
                    <input class="form-control" type="text"
                           ng-model="userScript.label"
                           ng-model-options="{
                             updateOn: 'default blur',
                             debounce: { 'default': 1000, 'blur': 0 }
                           }"
                           placeholder="Name of the user script">
                    <span class="input-group-btn">
                      <button class="btn btn-default" type="button"
                              ng-click="removeUserScript(userScript)">
                        <i class="fa fa-trash"></i>
                      </button>
                    </span>
                  </div>

                  <div class="ace-editor"
                       ui-ace="aceOpts"
                       ng-model="userScript.script"
                       ng-model-options="{
                         updateOn: 'default blur',
                         debounce: { 'default': 1000, 'blur': 0 }
                       }"></div>
                </div>

              </div>

            </div><!-- .user-script-item -->
          </div><!-- .user-script-list -->

          <div class="clearfix" ng-if="settings.sawXSSWarning">
            <button class="btn btn-primary pull-right" type="button" ng-click="addUserScript()">
              Add User Script
            </button>
          </div>

        </uib-tab>

        <uib-tab index="3" heading="Other Gestures">

          <div class="panel panel-default">
            <div class="panel-heading">
              <div class="checkbox clearfix">
                <label>
                  <input type="checkbox"
                         ng-model="settings.wheelGestures"></input>
                  Enable wheel gestures.
                </label>
                <div class="pull-right">
                  <i class="fa fa-info-circle"></i>
                  Hold the gesture button and scroll the mouse wheel to perform a wheel gesture.
                </div>
              </div>
            </div>
            <fieldset class="panel-body"
                      ng-disabled="!settings.wheelGestures">
              <div class="form-group">
                <label class="control-label">Scroll Up</label>
                <select class="form-control"
                        ng-options="item as item.label for item in mappables track by item.id"
                        ng-model="controls.wheelMappings.up"
                        ng-change="settings.wheelMappings.up = controls.wheelMappings.up.mapping"></select>
              </div>
              <div class="form-group">
                <label class="control-label">Scroll Down</label>
                <select class="form-control"
                        ng-options="item as item.label for item in mappables track by item.id"
                        ng-model="controls.wheelMappings.down"
                        ng-change="settings.wheelMappings.down = controls.wheelMappings.down.mapping"></select>
              </div>
              <div class="form-group">
                <label class="control-label">Scroll Left</label>
                <select class="form-control"
                        ng-options="item as item.label for item in mappables track by item.id"
                        ng-model="controls.wheelMappings.left"
                        ng-change="settings.wheelMappings.left = controls.wheelMappings.left.mapping"></select>
              </div>
              <div class="form-group">
                <label class="control-label">Scroll Right</label>
                <select class="form-control"
                        ng-options="item as item.label for item in mappables track by item.id"
                        ng-model="controls.wheelMappings.right"
                        ng-change="settings.wheelMappings.right = controls.wheelMappings.right.mapping"></select>
              </div>
            </fieldset>
          </div>

        </uib-tab>

        <uib-tab index="4" heading="More Preferences">

          <div class="well">
            <i class="fa fa-2x fa-info-circle"></i>
            <span>
              Preferences to modify the behaviour of built-in commands and other tweaks.
            </span>
          </div>

          <div class="row">
            <div class="col-md-6">

              <h4>Tab and Window Commands</h4>

              <!-- Insert related tab -->
              <div class="form-group">
                <div class="checkbox">
                  <label>
                    <input type="checkbox"
                           ng-model="settings.insertRelatedTab"></input>
                    Open in New Tab family of commands insert the tab after the current tab.
                    This setting is similar browser.tabs.insertRelatedAfterCurrent.
                  </label>
                </div>
              </div>

              <!-- New tab is active -->
              <div class="form-group">
                <div class="checkbox">
                  <label>
                    <input type="checkbox"
                           ng-model="settings.insertTabIsActive"></input>
                    Immediately switch focus to tabs created by Open in New Tab family of commands.
                  </label>
                </div>
              </div>

              <!-- Next/previous tab wraps -->
              <div class="form-group">
                <div class="checkbox">
                  <label>
                    <input type="checkbox"
                           ng-model="settings.nextTabWrap"></input>
                    Next Tab and Previous Tab commands wrap from last tab to first tab.
                  </label>
                </div>
              </div>

              <!-- New tab default URL -->
              <div class="form-group">
                <label class="control-label">Default URL for tabs opened with New Tab command</label>
                <input class="form-control" type="text"
                       ng-model="settings.newTabUrl"></input>
                <p class="help-block">
                  Leave this field empty to use the default URL about:newtab.
                  Unplivileged about: pages like about:blank and about:home are also acceptable.
                </p>
              </div>

              <!-- New window default URL -->
              <div class="form-group">
                <label class="control-label">Default URL for windows opened with New Window command</label>
                <input class="form-control" type="text"
                       ng-model="settings.newWindowUrl"></input>
                <p class="help-block">
                  Leave this field empty to use the default URL about:newtab.
                  Unplivileged about: pages like about:blank and about:home are also acceptable.
                </p>
              </div>

              <!-- New private window default URL -->
              <div class="form-group">
                <label class="control-label">Default URL for windows opened with New Private Window command</label>
                <input class="form-control" type="text"
                       ng-model="settings.newPrivateWindowUrl"></input>
                <p class="help-block">
                  Leave this field empty to use the default URL about:newtab.
                  Unplivileged about: pages like about:blank and about:home are also acceptable.
                </p>
              </div>

            </div><!-- /.col-md-6 -->
            <div class="col-md-6">

              <h4>Navigation and Scrolling</h4>

              <!-- Use link rel next or prev -->
              <div class="form-group">
                <div class="checkbox">
                  <label>
                    <input type="checkbox"
                           ng-model="settings.useRelPrevNext"></input>
                    Page Up and Page Down commands follow rel=next and rel=prev attributes. See:
                    <a href="https://support.google.com/webmasters/answer/1663744?hl=en">
                      Indicate paginated content
                    </a>.
                  </label>
                </div>
              </div>

              <!-- Scroll duration -->
              <div class="form-group" ng-class="{'has-error':controls.optionsForm.scrollDuration.$invalid}">
                <label class="control-label">Duration of the animation for the Scroll to Top/Bottom commands</label>
                <div class="input-group">
                  <input class="form-control" type="number" name="scrollDuration"
                         min="0" max="10000"
                         ng-model="settings.scrollDuration"></input>
                  <span class="input-group-addon">milliseconds</span>
                </div>
                <p class="help-block">
                  Use zero to disable.
                </p>
              </div>

            </div><!-- /.col-md-6 -->
          </div><!-- /.row -->

        </uib-tab>

        <uib-tab index="5" heading="Backup &amp; Restore" select="onBackupTabSelect()">
          <div ng-include="'/options/options.tab.backup.html'"></div>
        </uib-tab>

      </uib-tabset>

    </form><!-- ng-if loaded -->

    <!--
    <pre>{{settings | json}}</pre>
    <pre>{{controls | json}}</pre>
    <pre>{{mappable | json}}</pre>
    -->

    <!-- Library components -->
    <script src="lib/angular.min.js"></script>
    <script src="lib/ui-bootstrap-custom-tpls-2.5.0.min.js"></script>
    <script src="lib/ace/ace.js"></script>
    <script src="lib/ui-ace.min.js"></script>
    <script src="options.js"></script>
    <script src="options.tab.backup.js"></script>

  </body>

</html>
